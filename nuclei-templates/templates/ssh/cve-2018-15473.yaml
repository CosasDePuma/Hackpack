---
id: cve-2018-15473
info:
  name: User Enumeration in OpenSSH < 7.7
  author: cosasdepuma
  severity: medium
  description: |
    OpenSSH through 7.7 is prone to a user enumeration vulnerability due to not delaying bailout for an invalid authenticating user until after the packet containing the request has been fully parsed, related to auth2-gss.c, auth2-hostbased.c, and auth2-pubkey.c.
  remediation: |-
    Upgrade to OpenSSH 7.7 or later.  
  reference:
    - https://www.openwall.com/lists/oss-security/2018/08/15/5
    - https://datatracker.ietf.org/doc/html/rfc4252
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
    cve-id: CVE-2018-15473
    cwe-id: CWE-208
  metadata:
    verified: true
    max-request: 1
    shodan-query:
      - vuln:CVE-2018-15473
  tags: cosasdepuma,cve,passive,ssh,openssh
javascript:
  - pre-condition: |-
      isPortOpen(Host,Port);
    code: |-
      const max_version = [7,7];
      const m = require("nuclei/ssh");
      const c = m.SSHClient();
      const response = c.ConnectSSHInfoMode(Host, Port);
      const auth_methods = response.UserAuth.filter(method => method.startsWith("gssapi-") || ["hostbased","publickey"].includes(method));
      if(auth_methods.length > 0) {
      const regex = new RegExp(/OpenSSH_([0-9]+\.[0-9]+(?:\.[0-9]+)?)/);
      const version = regex.exec(response.ServerID.SoftwareVersion);
      if(version && version.length > 1) {
      const splitted_version = version[1].split('.');
      if(splitted_version[0] < max_version[0] 
      || (splitted_version[0] <= max_version[0] && splitted_version[1] < max_version[1]))
      Export(`${response.ServerID.SoftwareVersion.replaceAll('_',' ')} (${auth_methods.join(",")})`);
      }
      }
    args:
      Host: "{{Host}}"
      Port: 22
    extractors:
      - type: dsl
        dsl:
          - response
...
